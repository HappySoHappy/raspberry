<!DOCTYPE html>
<html>
<head>
  <title>Information</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #0f0; padding: 20px; }
    h1 { color: #0ff; }
    .stat { margin-bottom: 10px; }
  </style>
</head>
<body>
  <div id="stats">
    <div class="stat">Fetching information...</div>
  </div>

  <div id="links" style="margin-top: 1em;">
    Panels:
  </div>

  <script>
    const linksToAdd = [
      {
        url: `http://${window.location.hostname}:5000/cdn/panel/`,
        text: 'CDN panel'
      },
    ];

    const linksDiv = document.getElementById('links');
    linksToAdd.forEach(link => {
      const a = document.createElement('a');
      a.href = link.url;
      a.target = '_blank';
      a.rel = 'noopener noreferrer';
      a.textContent = link.text;
      a.style.display = 'block';
      a.style.marginBottom = '6px';
      a.style.color = '#0f0';
      linksDiv.appendChild(a);
    });
  </script>

  <script>
  function formatBytes(bytes) {
    if (bytes === 0 || bytes == null) return '0 B';
    const k = 1024;
    const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    const value = bytes / Math.pow(k, i);
    return `${value.toFixed(2)} ${sizes[i]}`;
  }

  async function fetchStats() {
    try {
      const res = await fetch('/api/stats2');
      const data = await res.json();

      const container = document.getElementById('stats');
      container.innerHTML = ''; // Clear previous

      const os = data.os || {};
      const cpu = data.cpu || {};
      const memory = data.memory || {};
      const disk = (data.disks && data.disks[0]) || {};
      const uptime = data.uptime || {};
      const node = data.node || {};

      const entries = {
        'User': data.user || '',
        'Hostname': data.hostname || '',
        'IP': data.ip || '',
        'OS': os.distro ? `${os.distro} ${os.release || ''} (${os.arch || ''})` : 'Unknown',
        'Kernel': os.kernel || '',
        'CPU': (cpu.manufacturer != null ? `${cpu.manufacturer} ` : '') + cpu.brand || '',
        'CPU Load': cpu.load != null ? `${cpu.load.toFixed(2)} avg` : '',
        'CPU Temp': cpu.temperature != null ? `${cpu.temperature} Â°C` : 'N/A',
        'Memory': (memory.used != null && memory.total != null)
          ? `${formatBytes(memory.used)} / ${formatBytes(memory.total)}`
          : 'N/A',
        'Disk': (disk.used != null && disk.size != null)
          ? `${formatBytes(disk.used)} / ${formatBytes(disk.size)} (${disk.usePercent || 0}%)`
          : 'N/A',
        'Uptime': uptime.human || '',
        'Shell': data.shell || '',
        'Terminal': data.terminal || '',
        'Node Version': node.version || '',
        'Node Working Directory': node.cwd || '',
        'Node Script': node.script || ''
      };

      for (const [label, value] of Object.entries(entries)) {
        if (value !== null && value !== undefined && value !== '') {
          const div = document.createElement('div');
          div.className = 'stat';
          div.textContent = `${label}: ${value}`;
          container.appendChild(div);
        }
      }

      // PM2 processes
      if (Array.isArray(data.pm2) && data.pm2.length > 0) {
        const pm2Title = document.createElement('div');
        pm2Title.className = 'stat';
        pm2Title.textContent = 'PM2 Processes:';
        container.appendChild(pm2Title);

        data.pm2.forEach(proc => {
          const div = document.createElement('div');
          div.className = 'stat';
          div.textContent = `${proc.name} [${proc.status}] - PID: ${proc.pid}`;
          container.appendChild(div);
        });
      }
    } catch (err) {
      document.getElementById('stats').innerHTML = `<div class="stat">Error fetching stats: ${err.message}</div>`;
    }
  }

  setInterval(fetchStats, 5000);
  fetchStats();
</script>
</body>
</html>
